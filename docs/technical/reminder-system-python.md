# Ø³ÛŒØ³ØªÙ… ÛŒØ§Ø¯Ø¢ÙˆØ±ÛŒ Ø³Ø±ÙˆÛŒØ³ Ø¯ÙˆØ±Ù‡â€ŒØ§ÛŒ Ø®ÙˆØ¯Ø±ÙˆÙ‡Ø§ Ø¨Ø§ Python

## ğŸ“‹ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ù„ÛŒ

**ØªØ§Ø±ÛŒØ® Ø§ÛŒØ¬Ø§Ø¯:** Û²Û· Ø¯ÛŒ Û±Û´Û°Û´
**Ù†ÙˆØ¹ Ù¾Ø±ÙˆÚ˜Ù‡:** Python Cron Job + Supabase + SPA
**Ù‡Ø¯Ù:** ÛŒØ§Ø¯Ø¢ÙˆØ±ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø± Ø³Ø±ÙˆÛŒØ³ Ø¯ÙˆØ±Ù‡â€ŒØ§ÛŒ Ø®ÙˆØ¯Ø±ÙˆÙ‡Ø§

---

## ğŸ¯ Ø³ÛŒÙ†Ø§Ø±ÛŒÙˆ Ùˆ Ù‡Ø¯Ù Ú©Ù„ÛŒ

### Ø³ÛŒÙ†Ø§Ø±ÛŒÙˆ:

- Ú©Ø§Ø±Ø¨Ø± **Ú†Ù†Ø¯ÛŒÙ† Ø®ÙˆØ¯Ø±Ùˆ** Ø¯Ø§Ø±Ø¯
- Ù‡Ø± Ø®ÙˆØ¯Ø±Ùˆ Ù†ÛŒØ§Ø² Ø¨Ù‡ **Ø³Ø±ÙˆÛŒØ³ Ø¯ÙˆØ±Ù‡â€ŒØ§ÛŒ Ø¨Ø§ ÙØ§ØµÙ„Ù‡ Ø²Ù…Ø§Ù†ÛŒ Ù…ØªÙØ§ÙˆØª** Ø¯Ø§Ø±Ø¯ (Ù…Ø«Ù„Ø§Ù‹ Û¶Û°ØŒ Û¹Û° ÛŒØ§ Û±Û²Û° Ø±ÙˆØ²)
- Ø§ÛŒÙ† ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¯Ø± Ø¬Ø¯ÙˆÙ„ `reminder_settings` Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ø®ÙˆØ¯Ø±Ùˆ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù‡ Ø§Ø³Øª
- Ú©Ø§Ø±Ø¨Ø± Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡Ø¯ **Ú†Ù†Ø¯ Ø±ÙˆØ² Ù‚Ø¨Ù„** Ø§Ø² Ù…ÙˆØ¹Ø¯ (Ù…Ø«Ù„Ø§Ù‹ Û· Ø±ÙˆØ²)ØŒ ÛŒØ§Ø¯Ø¢ÙˆØ±ÛŒ Ø¯Ø±ÛŒØ§ÙØª Ú©Ù†Ø¯
- ÛŒØ§Ø¯Ø¢ÙˆØ±ÛŒ Ø§Ø² Ø·Ø±ÛŒÙ‚: **Ø§ÛŒÙ…ÛŒÙ„ + Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù† Ø¯Ø±ÙˆÙ†â€ŒØ¨Ø±Ù†Ø§Ù…Ù‡â€ŒØ§ÛŒ**

### Ù‡Ø¯Ù:

- **Ø®ÙˆØ¯Ú©Ø§Ø±Ø³Ø§Ø²ÛŒ:** Ø¨Ø¯ÙˆÙ† Ù†ÛŒØ§Ø² Ø¨Ù‡ ÛŒØ§Ø¯Ø¢ÙˆØ±ÛŒ Ø¯Ø³ØªÛŒ
- **Ø²Ù…Ø§Ù†â€ŒØ¨Ù†Ø¯ÛŒ Ø¯Ù‚ÛŒÙ‚:** Ø¨Ø±Ø±Ø³ÛŒ Ø±ÙˆØ²Ø§Ù†Ù‡
- **Ú†Ù†Ø¯Ú©Ø§Ù†Ø§Ù„Ù‡:** Ø§ÛŒÙ…ÛŒÙ„ + Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù†
- **Ù‚Ø§Ø¨Ù„ ØªÙ†Ø¸ÛŒÙ…:** Ù‡Ø± Ú©Ø§Ø±Ø¨Ø± Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ø®ÙˆØ¯Ø±Ùˆ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù…Ø®ØµÙˆØµ Ø¯Ø§Ø±Ø¯

---

## ğŸ—ï¸ Ù…Ø¹Ù…Ø§Ø±ÛŒ Ø³ÛŒØ³ØªÙ…

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Python Cron Job (Ú†Ø§Ø¨Ú©Ø§Ù†)                                   â”‚
â”‚  - Ø§Ø¬Ø±Ø§: Ù‡Ø± Ø±ÙˆØ² Ø³Ø§Ø¹Øª Û¸ ØµØ¨Ø­                                   â”‚
â”‚  - ÙˆØ¸ÛŒÙÙ‡: Ø¨Ø±Ø±Ø³ÛŒ ÛŒØ§Ø¯Ø¢ÙˆØ±Ù‡Ø§ + Ø§ÛŒØ¬Ø§Ø¯ Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù†                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Supabase (Ø¯ÛŒØªØ§Ø¨ÛŒØ³)                                         â”‚
â”‚  - Ø¬Ø¯ÙˆÙ„ notifications (Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù†â€ŒÙ‡Ø§)                       â”‚
â”‚  - Ø¬Ø¯ÙˆÙ„ reminder_settings (ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù‡Ø± Ø®ÙˆØ¯Ø±Ùˆ)                â”‚
â”‚  - Ø¬Ø¯ÙˆÙ„ vehicles + services (Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø®ÙˆØ¯Ø±ÙˆÙ‡Ø§)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SPA ÙØ±Ø§Ù†Øªâ€ŒØ§Ù†Ø¯ (SvelteKit)                                   â”‚
â”‚  - Realtime Supabase (Ù†Ù…Ø§ÛŒØ´ ÙÙˆØ±ÛŒ)                           â”‚
â”‚  - notificationService.ts (Ø®ÙˆØ§Ù†Ø¯Ù† Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù†â€ŒÙ‡Ø§)           â”‚
â”‚  - UI Ú©Ø§Ù…Ù¾ÙˆÙ†Ù†Øª (Ù†Ù…Ø§ÛŒØ´ Ùˆ Ù…Ø¯ÛŒØ±ÛŒØª)                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ Ù…Ø±Ø§Ø­Ù„ Ø§Ø¬Ø±Ø§ (Û¶ Ù…Ø±Ø­Ù„Ù‡)

### Ù…Ø±Ø­Ù„Ù‡ Û±: ØªØºÛŒÛŒØ±Ø§Øª Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Supabase

**ÙØ§ÛŒÙ„:** 

```sql
-- 1. Ø§ÛŒØ¬Ø§Ø¯ Ø¬Ø¯ÙˆÙ„ notifications
CREATE TABLE public.notifications (
    id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
    user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE NOT NULL,
    vehicle_id BIGINT REFERENCES public.vehicles(vehicle_id),
    title TEXT NOT NULL,
    body TEXT,
    type VARCHAR(50) NOT NULL CHECK (type IN ('reminder', 'warning', 'info', 'subscription')),
    read BOOLEAN DEFAULT FALSE,
    metadata JSONB,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- 2. ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† RLS
ALTER TABLE public.notifications ENABLE ROW LEVEL SECURITY;

-- 3. Ù¾Ø§Ù„ÛŒØ³ÛŒâ€ŒÙ‡Ø§
CREATE POLICY "Users can view their own notifications" ON public.notifications
    FOR SELECT USING (auth.uid() = user_id);

CREATE POLICY "Users can insert their own notifications" ON public.notifications
    FOR INSERT WITH CHECK (auth.uid() = user_id);

CREATE POLICY "Users can update their own notifications" ON public.notifications
    FOR UPDATE USING (auth.uid() = user_id);

-- 4. Indexâ€ŒÙ‡Ø§
CREATE INDEX idx_notifications_user_id ON public.notifications(user_id);
CREATE INDEX idx_notifications_created_at ON public.notifications(created_at DESC);
CREATE INDEX idx_notifications_vehicle_type ON public.notifications(vehicle_id, type);
CREATE INDEX idx_notifications_user_read ON public.notifications(user_id, read);

-- 5. ØªØ±ÛŒÚ¯Ø± updated_at
CREATE OR REPLACE FUNCTION public.handle_updated_at()
RETURNS TRIGGER AS $$
BEGIN
    NEW.updated_at = NOW();
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER set_updated_at_notifications
    BEFORE UPDATE ON public.notifications
    FOR EACH ROW
    EXECUTE FUNCTION public.handle_updated_at();

-- 6. Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø³ØªÙˆÙ† reminder_mode Ø¨Ù‡ reminder_settings
ALTER TABLE public.reminder_settings 
ADD COLUMN IF NOT EXISTS reminder_mode VARCHAR(20) NOT NULL DEFAULT 'time' 
CHECK (reminder_mode IN ('km', 'time', 'both'));

ALTER TABLE public.reminder_settings 
ADD COLUMN IF NOT EXISTS is_enabled BOOLEAN NOT NULL DEFAULT TRUE;

-- 7. ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Realtime Ø¨Ø±Ø§ÛŒ notifications
ALTER TABLE public.notifications REPLICA IDENTITY FULL;

-- 8. Ú©Ø§Ù…Ù†Øªâ€ŒÙ‡Ø§
COMMENT ON TABLE public.notifications IS 'Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù†â€ŒÙ‡Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¨Ø±Ø§ÛŒ ÛŒØ§Ø¯Ø¢ÙˆØ±ÛŒ Ùˆ Ù‡Ø´Ø¯Ø§Ø±Ù‡Ø§';

-- 9. ØªØ§Ø¨Ø¹ Ú©Ù…Ú©ÛŒ Ø¨Ø±Ø§ÛŒ Ø¯Ø±ÛŒØ§ÙØª Ø®ÙˆØ¯Ø±ÙˆÙ‡Ø§ÛŒ Ù†ÛŒØ§Ø²Ù…Ù†Ø¯ ÛŒØ§Ø¯Ø¢ÙˆØ±ÛŒ
CREATE OR REPLACE FUNCTION public.get_vehicles_for_reminder()
RETURNS TABLE (
    vehicle_id BIGINT,
    user_id UUID,
    model VARCHAR,
    plate_number VARCHAR,
    interval_days INTEGER,
    interval_km INTEGER,
    warning_days_before INTEGER,
    warning_km_before INTEGER,
    reminder_mode VARCHAR,
    is_enabled BOOLEAN
) AS $$
BEGIN
    RETURN QUERY
    SELECT 
        v.vehicle_id,
        v.user_id,
        v.model,
        v.plate_number,
        rs.interval_days,
        rs.interval_km,
        rs.warning_days_before,
        rs.warning_km_before,
        rs.reminder_mode,
        rs.is_enabled
    FROM public.vehicles v
    JOIN public.reminder_settings rs ON v.vehicle_id = rs.vehicle_id
    WHERE rs.is_enabled = TRUE 
      AND rs.reminder_mode IN ('time', 'both');
END;
$$ LANGUAGE plpgsql;
```

---

### Ù…Ø±Ø­Ù„Ù‡ Û²: Ú©Ø¯ Python Ø¨Ø±Ø§ÛŒ Cron Job

**Ø³Ø§Ø®ØªØ§Ø± Ù¾ÙˆØ´Ù‡:**

```
reminder-service/
â”œâ”€â”€ main.py
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ .env.example
â””â”€â”€ Dockerfile (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)
```

**ÙØ§ÛŒÙ„: `main.py`**

```python
import os
from supabase import create_client, Client
from datetime import datetime, timedelta
import schedule
import time
import logging
from dotenv import load_dotenv
import sys

# Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ù…Ø­ÛŒØ·ÛŒ Ø§Ø² ÙØ§ÛŒÙ„ .env
load_dotenv()

# ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù„Ø§Ú¯
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(levelname)s - %(message)s',
    handlers=[
        logging.StreamHandler(sys.stdout)
    ]
)

# Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ùˆ Ø¨Ø±Ø±Ø³ÛŒ Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ù…Ø­ÛŒØ·ÛŒ
SUPABASE_URL = os.environ.get("SUPABASE_URL")
SUPABASE_KEY = os.environ.get("SUPABASE_SERVICE_ROLE_KEY")
CRON_TIME = os.environ.get("CRON_TIME", "08:00")

# Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¬ÙˆØ¯ Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ø¶Ø±ÙˆØ±ÛŒ
if not SUPABASE_URL:
    logging.error("âŒ Ø®Ø·Ø§: Ù…ØªØºÛŒØ± SUPABASE_URL ØªÙ†Ø¸ÛŒÙ… Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª")
    sys.exit(1)

if not SUPABASE_KEY:
    logging.error("âŒ Ø®Ø·Ø§: Ù…ØªØºÛŒØ± SUPABASE_SERVICE_ROLE_KEY ØªÙ†Ø¸ÛŒÙ… Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª")
    sys.exit(1)

# Ø§ÛŒØ¬Ø§Ø¯ Ú©Ù„Ø§ÛŒÙ†Øª Supabase
try:
    supabase: Client = create_client(SUPABASE_URL, SUPABASE_KEY)
    logging.info("âœ… Ø§ØªØµØ§Ù„ Ø¨Ù‡ Supabase Ø¨Ø±Ù‚Ø±Ø§Ø± Ø´Ø¯")
except Exception as e:
    logging.error(f"âŒ Ø®Ø·Ø§ Ø¯Ø± Ø§ØªØµØ§Ù„ Ø¨Ù‡ Supabase: {str(e)}")
    sys.exit(1)

def check_time_based_reminders():
    """
    Ø¨Ø±Ø±Ø³ÛŒ ÛŒØ§Ø¯Ø¢ÙˆØ±Ù‡Ø§ÛŒ Ø²Ù…Ø§Ù†ÛŒ Ùˆ Ø§ÛŒØ¬Ø§Ø¯ Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù†
    Ø¨Ø± Ø§Ø³Ø§Ø³ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù…ØªÙØ§ÙˆØª Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ø®ÙˆØ¯Ø±Ùˆ
    """
    logging.info("=" * 50)
    logging.info("Ø´Ø±ÙˆØ¹ Ø¨Ø±Ø±Ø³ÛŒ ÛŒØ§Ø¯Ø¢ÙˆØ±Ù‡Ø§ÛŒ Ø²Ù…Ø§Ù†ÛŒ...")
  
    try:
        # Ø®ÙˆØ§Ù†Ø¯Ù† ØªÙ…Ø§Ù… Ø®ÙˆØ¯Ø±ÙˆÙ‡Ø§ÛŒ ÙØ¹Ø§Ù„ Ø¨Ø§ ØªÙ†Ø¸ÛŒÙ…Ø§Øª ÛŒØ§Ø¯Ø¢ÙˆØ±ÛŒ Ø²Ù…Ø§Ù†ÛŒ
        vehicles_response = supabase.rpc('get_vehicles_for_reminder').execute()
    
        if not vehicles_response.data:
            logging.info("Ù‡ÛŒÚ† Ø®ÙˆØ¯Ø±ÙˆÛŒÛŒ Ø¨Ø±Ø§ÛŒ ÛŒØ§Ø¯Ø¢ÙˆØ±ÛŒ Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯")
            return
    
        logging.info(f"ØªØ¹Ø¯Ø§Ø¯ {len(vehicles_response.data)} Ø®ÙˆØ¯Ø±Ùˆ Ø¨Ø±Ø§ÛŒ Ø¨Ø±Ø±Ø³ÛŒ")
    
        for vehicle in vehicles_response.data:
            try:
                # Ø®ÙˆØ§Ù†Ø¯Ù† Ø¢Ø®Ø±ÛŒÙ† Ø³Ø±ÙˆÛŒØ³
                last_service = supabase.table("services") \
                    .select("*") \
                    .eq("vehicle_id", vehicle["vehicle_id"]) \
                    .order("service_date_gregorian", desc=True) \
                    .limit(1) \
                    .execute()
            
                if not last_service.data:
                    logging.warning(f"Ø®ÙˆØ¯Ø±Ùˆ {vehicle['model']} - Ø³Ø±ÙˆÛŒØ³ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡")
                    continue
            
                last_date = datetime.strptime(
                    last_service.data[0]["service_date_gregorian"], 
                    "%Y-%m-%d"
                ).date()
            
                # Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø±ÙˆØ²Ù‡Ø§ÛŒ Ù…Ø§Ù†Ø¯Ù‡ Ø¨Ø± Ø§Ø³Ø§Ø³ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù‡Ø± Ø®ÙˆØ¯Ø±Ùˆ
                days_since_last = (datetime.now().date() - last_date).days
                interval_days = vehicle["interval_days"]  # Ù…ØªÙØ§ÙˆØª Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ø®ÙˆØ¯Ø±Ùˆ
                days_until_due = interval_days - days_since_last
            
                # Ø¨Ø±Ø±Ø³ÛŒ Ø¢ÛŒØ§ Ø¯Ø± Ø¨Ø§Ø²Ù‡ Ù‡Ø´Ø¯Ø§Ø± Ø§Ø³ØªØŸ
                warning_days = vehicle["warning_days_before"]
            
                if 0 < days_until_due <= warning_days:
                    # Ù…Ø­Ø§Ø³Ø¨Ù‡ ØªØ§Ø±ÛŒØ® Ù…ÙˆØ¹Ø¯ Ø¨Ø±Ø§ÛŒ Ø¨Ø±Ø±Ø³ÛŒ Ø¯Ù‚ÛŒÙ‚â€ŒØªØ±
                    due_date = last_date + timedelta(days=interval_days)
                    today = datetime.now().date()
                  
                    # Ø¨Ø±Ø±Ø³ÛŒ Ø§ÛŒÙ†Ú©Ù‡ Ù‚Ø¨Ù„Ø§Ù‹ Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ù…ÙˆØ¹Ø¯ Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù† Ø§Ø±Ø³Ø§Ù„ Ù†Ø´Ø¯Ù‡ Ø¨Ø§Ø´Ø¯
                    # Ø¨Ø±Ø±Ø³ÛŒ Ø¨Ø± Ø§Ø³Ø§Ø³ vehicle_id Ùˆ days_until_due Ø¯Ø± metadata
                    existing = supabase.table("notifications") \
                        .select("*") \
                        .eq("vehicle_id", vehicle["vehicle_id"]) \
                        .eq("type", "reminder") \
                        .eq("read", False) \
                        .gte("created_at", (datetime.now() - timedelta(days=warning_days + 1)).isoformat()) \
                        .execute()
                
                    # Ø¨Ø±Ø±Ø³ÛŒ Ø§ÛŒÙ†Ú©Ù‡ Ø¢ÛŒØ§ Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù† Ø¨Ø§ Ù‡Ù…Ø§Ù† days_until_due ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯
                    notification_exists = False
                    if existing.data:
                        for notif in existing.data:
                            metadata = notif.get("metadata", {})
                            if metadata.get("days_until_due") == days_until_due:
                                notification_exists = True
                                break
                
                    if notification_exists:
                        logging.info(f"âœ… Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù† Ù‚Ø¨Ù„Ø§Ù‹ Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯Ù‡: {vehicle['model']} - {days_until_due} Ø±ÙˆØ² Ù…Ø§Ù†Ø¯Ù‡")
                        continue
                
                    # Ø§ÛŒØ¬Ø§Ø¯ Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù†
                    notification = {
                        "user_id": vehicle["user_id"],
                        "vehicle_id": vehicle["vehicle_id"],
                        "title": "ÛŒØ§Ø¯Ø¢ÙˆØ±ÛŒ Ø³Ø±ÙˆÛŒØ³ Ø¯ÙˆØ±Ù‡â€ŒØ§ÛŒ",
                        "body": f"Ø®ÙˆØ¯Ø±Ùˆ {vehicle['model']} ({vehicle['plate_number']}) Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø³Ø±ÙˆÛŒØ³ Ø¯ÙˆØ±Ù‡â€ŒØ§ÛŒ Ø¯Ø§Ø±Ø¯. {days_until_due} Ø±ÙˆØ² ØªØ§ Ù…ÙˆØ¹Ø¯ ({interval_days} Ø±ÙˆØ²) Ø¨Ø§Ù‚ÛŒ Ù…Ø§Ù†Ø¯Ù‡ Ø§Ø³Øª.",
                        "type": "reminder",
                        "metadata": {
                            "vehicle_model": vehicle["model"],
                            "plate_number": vehicle["plate_number"],
                            "days_until_due": days_until_due,
                            "interval_days": interval_days,
                            "last_service_date": last_service.data[0]["service_date_gregorian"],
                            "due_date": (last_date + timedelta(days=interval_days)).isoformat()
                        }
                    }
                
                    result = supabase.table("notifications").insert(notification).execute()
                
                    if result.data:
                        logging.info(f"âœ… Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù† Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯: {vehicle['model']} - {days_until_due} Ø±ÙˆØ² Ù…Ø§Ù†Ø¯Ù‡ (Ù…ÙˆØ¹Ø¯: {interval_days} Ø±ÙˆØ²)")
                    else:
                        logging.error(f"âŒ Ø®Ø·Ø§ Ø¯Ø± Ø§ÛŒØ¬Ø§Ø¯ Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù†: {vehicle['model']}")
            
            except Exception as e:
                logging.error(f"âŒ Ø®Ø·Ø§ Ø¯Ø± Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø®ÙˆØ¯Ø±Ùˆ {vehicle.get('model', 'unknown')}: {str(e)}")
                logging.exception("Ø¬Ø²Ø¦ÛŒØ§Øª Ø®Ø·Ø§:")
                continue
    
        logging.info("âœ… Ù¾Ø§ÛŒØ§Ù† Ø¨Ø±Ø±Ø³ÛŒ ÛŒØ§Ø¯Ø¢ÙˆØ±Ù‡Ø§")
        logging.info("=" * 50)
    
    except Exception as e:
        logging.error(f"âŒ Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ù„ÛŒØ³Øª Ø®ÙˆØ¯Ø±ÙˆÙ‡Ø§: {str(e)}")
        logging.exception("Ø¬Ø²Ø¦ÛŒØ§Øª Ø®Ø·Ø§:")

def main():
    """
    Ø§Ø¬Ø±Ø§ÛŒ Ø§ØµÙ„ÛŒ Ø¨Ø±Ù†Ø§Ù…Ù‡
    """
    logging.info("Ø³Ø±ÙˆÛŒØ³ ÛŒØ§Ø¯Ø¢ÙˆØ±ÛŒ Ø³Ø±ÙˆÛŒØ³ Ø¯ÙˆØ±Ù‡â€ŒØ§ÛŒ Ø´Ø±ÙˆØ¹ Ø´Ø¯...")
    logging.info(f"Ø²Ù…Ø§Ù† Ø§Ø¬Ø±Ø§: {CRON_TIME}")
  
    # ØªÙ†Ø¸ÛŒÙ… Cron Job
    schedule.every().day.at(CRON_TIME).do(check_time_based_reminders)
  
    # Ø§Ø¬Ø±Ø§ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ Ø¨Ø±Ø§ÛŒ ØªØ³Øª
    logging.info("Ø§Ø¬Ø±Ø§ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ Ø¨Ø±Ø§ÛŒ ØªØ³Øª...")
    check_time_based_reminders()
  
    # Ø­Ù„Ù‚Ù‡ Ø§ØµÙ„ÛŒ
    while True:
        schedule.run_pending()
        time.sleep(60)

if __name__ == "__main__":
    main()
```

---

### Ù…Ø±Ø­Ù„Ù‡ Û³: ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ Python

**ÙØ§ÛŒÙ„: `requirements.txt`**

```
supabase==2.4.0
schedule==1.2.0
python-dotenv==1.0.0
```

**ÙØ§ÛŒÙ„: `.env.example`**

```
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key
CRON_TIME=08:00
```

**ÙØ§ÛŒÙ„: `Dockerfile` (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)**

```dockerfile
FROM python:3.11-slim

WORKDIR /app

COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

COPY main.py .

CMD ["python", "main.py"]
```

---

### Ù…Ø±Ø­Ù„Ù‡ Û´: ØªØºÛŒÛŒØ±Ø§Øª Ø¯Ø± ÙØ±Ø§Ù†Øªâ€ŒØ§Ù†Ø¯ (SPA)

**ÙØ§ÛŒÙ„ Ø¬Ø¯ÛŒØ¯: `frontend/src/lib/services/notificationService.ts`**

```typescript
import { supabase } from '../supabase';
import type { Notification } from '$lib/types';

export const notificationService = {
  // Ø®ÙˆØ§Ù†Ø¯Ù† Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù†â€ŒÙ‡Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±
  async getNotifications(userId: string, onlyUnread: boolean = true): Promise<Notification[]> {
    if (!supabase) {
      throw new Error('Supabase client not available. Check VITE_BACKEND_TYPE and environment variables.');
    }

    let query = supabase
      .from('notifications')
      .select('*')
      .eq('user_id', userId)
      .order('created_at', { ascending: false })
      .limit(50);

    if (onlyUnread) {
      query = query.eq('read', false);
    }

    const { data, error } = await query;

    if (error) throw error;
    return data || [];
  },

  // Ø¹Ù„Ø§Ù…Øªâ€ŒÚ¯Ø°Ø§Ø±ÛŒ Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† Ø®ÙˆØ§Ù†Ø¯Ù‡â€ŒØ´Ø¯Ù‡
  async markAsRead(notificationId: string): Promise<void> {
    if (!supabase) {
      throw new Error('Supabase client not available. Check VITE_BACKEND_TYPE and environment variables.');
    }

    const { error } = await supabase
      .from('notifications')
      .update({ read: true })
      .eq('id', notificationId);

    if (error) throw error;
  },

  // Ø¹Ù„Ø§Ù…Øªâ€ŒÚ¯Ø°Ø§Ø±ÛŒ Ù‡Ù…Ù‡ Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† Ø®ÙˆØ§Ù†Ø¯Ù‡â€ŒØ´Ø¯Ù‡
  async markAllAsRead(userId: string): Promise<void> {
    if (!supabase) {
      throw new Error('Supabase client not available. Check VITE_BACKEND_TYPE and environment variables.');
    }

    const { error } = await supabase
      .from('notifications')
      .update({ read: true })
      .eq('user_id', userId)
      .eq('read', false);

    if (error) throw error;
  },

  // Ú¯ÙˆØ´ Ø¯Ø§Ø¯Ù† Ø¨Ù‡ Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù†â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ (Realtime)
  subscribeToNotifications(userId: string, callback: (notification: Notification) => void) {
    if (!supabase) {
      console.error('Supabase client not available. Realtime subscription will not work.');
      return null;
    }

    const channel = supabase
      .channel('public:notifications')
      .on(
        'postgres_changes',
        {
          event: 'INSERT',
          schema: 'public',
          table: 'notifications',
          filter: `user_id=eq.${userId}`
        },
        (payload) => {
          callback(payload.new as Notification);
        }
      )
      .subscribe();

    return channel;
  },

  // Ø´Ù…Ø§Ø±Ø´ Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù†â€ŒÙ‡Ø§ÛŒ unread
  async getUnreadCount(userId: string): Promise<number> {
    if (!supabase) {
      throw new Error('Supabase client not available. Check VITE_BACKEND_TYPE and environment variables.');
    }

    const { count, error } = await supabase
      .from('notifications')
      .select('*', { count: 'exact' })
      .eq('user_id', userId)
      .eq('read', false);

    if (error) throw error;
    return count || 0;
  }
};
```

**ÙØ§ÛŒÙ„: `frontend/src/lib/types/index.ts`**

```typescript
export interface Notification {
  id: string;
  user_id: string;
  vehicle_id?: number;
  title: string;
  body: string;
  type: 'reminder' | 'warning' | 'info' | 'subscription';
  read: boolean;
  metadata?: any;
  created_at: string;
  updated_at: string;
}
```

---

### Ù…Ø±Ø­Ù„Ù‡ Ûµ: ØªØºÛŒÛŒØ±Ø§Øª UI (Ú©Ø§Ù…Ù¾ÙˆÙ†Ù†Øª Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù†)

**ÙØ§ÛŒÙ„ Ø¬Ø¯ÛŒØ¯: `frontend/src/lib/components/organisms/NotificationBell.svelte`**

```svelte
<script lang="ts">
  import { onMount, onDestroy } from 'svelte';
  import { notificationService } from '$lib/services/notificationService';
  import { authStore, currentUser } from '$lib/stores/auth';
  import { supabase } from '$lib/supabase';
  import { writable } from 'svelte/store';
  import type { Notification } from '$lib/types';

  let notifications = writable<Notification[]>([]);
  let unreadCount = writable(0);
  let isOpen = $state(false);
  let realtimeChannel: any = null;

  onMount(async () => {
    const user = $currentUser;
  
    if (user?.id) {
      await loadNotifications(user.id);
  
      realtimeChannel = notificationService.subscribeToNotifications(
        user.id,
        (newNotification) => {
          notifications.update(list => [newNotification, ...list]);
          unreadCount.update(c => c + 1);
          showToast(newNotification.title, newNotification.body);
        }
      );
    }
  });

  onDestroy(() => {
    if (realtimeChannel && supabase) {
      supabase.removeChannel(realtimeChannel);
    }
  });

  async function loadNotifications(userId: string) {
    try {
      const data = await notificationService.getNotifications(userId, true);
      notifications.set(data);
  
      const count = await notificationService.getUnreadCount(userId);
      unreadCount.set(count);
    } catch (error) {
      console.error('Error loading notifications:', error);
    }
  }

  async function markAsRead(id: string) {
    try {
      await notificationService.markAsRead(id);
      notifications.update(list => list.filter(n => n.id !== id));
      unreadCount.update(c => Math.max(0, c - 1));
    } catch (error) {
      console.error('Error marking as read:', error);
    }
  }

  async function markAllAsRead() {
    const user = $currentUser;
    if (!user?.id) return;
  
    try {
      await notificationService.markAllAsRead(user.id);
      notifications.set([]);
      unreadCount.set(0);
    } catch (error) {
      console.error('Error marking all as read:', error);
    }
  }

  function showToast(title: string, body: string) {
    // Ø¯Ø± ØµÙˆØ±Øª Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² toast system Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø§Ø² toastStore Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯
    // ÛŒØ§ ÛŒÚ© toast component Ø¬Ø¯Ø§Ú¯Ø§Ù†Ù‡ Ø¨Ø³Ø§Ø²ÛŒØ¯
    const toast = document.createElement('div');
    toast.className = 'toast-notification';
    toast.innerHTML = `
      <strong>${title}</strong>
      <p>${body}</p>
    `;
    document.body.appendChild(toast);
    setTimeout(() => toast.remove(), 5000);
  }

  $: user = $currentUser;
  $: userId = user?.id;
</script>

<div class="notification-bell">
  <button on:click={() => isOpen = !isOpen} class="bell-btn">
    ğŸ””
    {#if $unreadCount > 0}
      <span class="badge">{$unreadCount}</span>
    {/if}
  </button>

  {#if isOpen}
    <div class="notification-dropdown">
      <div class="header">
        <h3>Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù†â€ŒÙ‡Ø§</h3>
        <button on:click={markAllAsRead}>Ù‡Ù…Ù‡ Ø®ÙˆØ§Ù†Ø¯Ù‡ Ø´Ø¯</button>
      </div>
  
      <div class="list">
        {#if $notifications.length === 0}
          <p class="empty">Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù† Ø¬Ø¯ÛŒØ¯ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯</p>
        {:else}
          {#each $notifications as notification}
            <div class="notification-item" on:click={() => markAsRead(notification.id)}>
              <strong>{notification.title}</strong>
              <p>{notification.body}</p>
              <small>{new Date(notification.created_at).toLocaleString('fa-IR')}</small>
            </div>
          {/each}
        {/if}
      </div>
    </div>
  {/if}
</div>

<style>
  .notification-bell { position: relative; }
  .bell-btn { position: relative; font-size: 1.5rem; background: none; border: none; cursor: pointer; }
  .badge { position: absolute; top: -5px; right: -5px; background: red; color: white; border-radius: 50%; width: 20px; height: 20px; font-size: 0.75rem; display: flex; align-items: center; justify-content: center; }
  .notification-dropdown { position: absolute; top: 100%; right: 0; width: 350px; background: white; border: 1px solid #ddd; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); z-index: 1000; }
  .header { padding: 12px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; }
  .list { max-height: 400px; overflow-y: auto; }
  .notification-item { padding: 12px; border-bottom: 1px solid #f5f5f5; cursor: pointer; }
  .notification-item:hover { background: #f9f9f9; }
  .empty { padding: 20px; text-align: center; color: #999; }
</style>
```

**Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø¯Ø± Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯:**

```svelte
<!-- frontend/src/routes/dashboard/+page.svelte -->
<script>
  import NotificationBell from '$lib/components/organisms/NotificationBell.svelte';
</script>

<div class="dashboard">
  <header>
    <h1>Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯</h1>
    <NotificationBell />
  </header>
  <!-- Ø¨Ù‚ÛŒÙ‡ Ù…Ø­ØªÙˆØ§ -->
</div>
```

---

### Ù…Ø±Ø­Ù„Ù‡ Û¶: Ø§Ø³ØªÙ‚Ø±Ø§Ø± Ø¯Ø± Ú†Ø§Ø¨Ú©Ø§Ù†

**Ø§Ù„Ù) Ø§ÛŒØ¬Ø§Ø¯ Ø³Ø±ÙˆÛŒØ³ Python:**

1. ÙˆØ§Ø±Ø¯ Ù¾Ù†Ù„ Ú†Ø§Ø¨Ú©Ø§Ù† Ø´ÙˆÛŒØ¯
2. Ø¨Ù‡ Ø¨Ø®Ø´ **Ù‡Ø§Ø³Øª Ø§Ø¨Ø±ÛŒ (PaaS)** Ø¨Ø±ÙˆÛŒØ¯
3. Ø±ÙˆÛŒ **Ø§ÛŒØ¬Ø§Ø¯ Ø³Ø±ÙˆÛŒØ³ Ø¬Ø¯ÛŒØ¯** Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯
4. Ø§Ù†ØªØ®Ø§Ø¨: **Python**
5. ØªÙ†Ø¸ÛŒÙ…Ø§Øª:
   - Ù†Ø§Ù…: `reminder-service`
   - Ù…Ù†Ø¨Ø¹: Ø¢Ù¾Ù„ÙˆØ¯ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Python
   - Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ù…Ø­ÛŒØ·ÛŒ: Ø§Ø² `.env` Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯

**Ø¨) ØªÙ†Ø¸ÛŒÙ… Cron Job Ø¯Ø± Ú†Ø§Ø¨Ú©Ø§Ù†:**

- Ø¯Ø± Ø¨Ø®Ø´ **Cron Jobs** Ù¾Ù†Ù„ Ú†Ø§Ø¨Ú©Ø§Ù†
- Ø§ÛŒØ¬Ø§Ø¯ Cron Ø¬Ø¯ÛŒØ¯:
  - Ø²Ù…Ø§Ù†: `0 8 * * *` (Ù‡Ø± Ø±ÙˆØ² Ø³Ø§Ø¹Øª Û¸ ØµØ¨Ø­)
  - Ø¯Ø³ØªÙˆØ±: `python main.py`
  - Ù…Ø³ÛŒØ±: Ù¾ÙˆØ´Ù‡ Ø³Ø±ÙˆÛŒØ³

---

## âœ… Ù†ØªÛŒØ¬Ù‡ Ù†Ù‡Ø§ÛŒÛŒ

**ÙˆÙ‚ØªÛŒ Ù‡Ù…Ù‡ Ù…Ø±Ø§Ø­Ù„ Ø§Ø¬Ø±Ø§ Ø´ÙˆØ¯:**

1. **Ù‡Ø± Ø±ÙˆØ² Ø³Ø§Ø¹Øª Û¸ ØµØ¨Ø­:**

   - Python Cron Job Ø§Ø¬Ø±Ø§ Ù…ÛŒâ€ŒØ´ÙˆØ¯
   - Ø®ÙˆØ¯Ø±ÙˆÙ‡Ø§ÛŒÛŒ Ú©Ù‡ Ø¯Ø± Ø¨Ø§Ø²Ù‡ Ù‡Ø´Ø¯Ø§Ø± Ù‡Ø³ØªÙ†Ø¯ Ø±Ø§ Ù¾ÛŒØ¯Ø§ Ù…ÛŒâ€ŒÚ©Ù†Ø¯
   - Ø¨Ø± Ø§Ø³Ø§Ø³ `interval_days` Ù‡Ø± Ø®ÙˆØ¯Ø±Ùˆ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…ÛŒâ€ŒÚ©Ù†Ø¯
   - Ø¯Ø± Ø¬Ø¯ÙˆÙ„ `notifications` Ø±Ú©ÙˆØ±Ø¯ Ø§ÛŒØ¬Ø§Ø¯ Ù…ÛŒâ€ŒÚ©Ù†Ø¯
2. **Ø¨Ù„Ø§ÙØ§ØµÙ„Ù‡:**

   - Ú©Ø§Ø±Ø¨Ø± Ø¯Ø± Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù† Ø±Ø§ Ù…ÛŒâ€ŒØ¨ÛŒÙ†Ø¯ (Realtime)
   - Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø±ÙˆÛŒ Ø¢Ù† Ú©Ù„ÛŒÚ© Ú©Ù†Ø¯ Ùˆ Ø¬Ø²Ø¦ÛŒØ§Øª Ø±Ø§ Ø¨Ø¨ÛŒÙ†Ø¯
3. **Ù…Ø²Ø§ÛŒØ§:**

   - âœ… Ø®ÙˆØ¯Ú©Ø§Ø± Ùˆ Ø¨Ø¯ÙˆÙ† Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø¯Ø³ØªÛŒ
   - âœ… Realtime (Ø¨Ø¯ÙˆÙ† Ø±ÙØ±Ø´ ØµÙØ­Ù‡)
   - âœ… Ù‚Ø§Ø¨Ù„ ØªÙ†Ø¸ÛŒÙ… ØªÙˆØ³Ø· Ú©Ø§Ø±Ø¨Ø±
   - âœ… Ù‡Ø± Ø®ÙˆØ¯Ø±Ùˆ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù…Ø®ØµÙˆØµ Ø®ÙˆØ¯ Ø±Ø§ Ø¯Ø§Ø±Ø¯
   - âœ… Ø³Ø±ÙˆÛŒØ³â€ŒÙ‡Ø§ÛŒ ÙØ¹Ù„ÛŒ Ø¯Ø³Øª Ù†Ù…ÛŒâ€ŒØ®ÙˆØ±Ù†Ø¯

---

## ğŸ“¦ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù…ÙˆØ±Ø¯ Ù†ÛŒØ§Ø²

### Ø¯Ø± Ù¾Ø±ÙˆÚ˜Ù‡ Ø§ØµÙ„ÛŒ:

```
OilChenger/
â”œâ”€â”€ supabase/migrations/004_notifications.sql
â””â”€â”€ frontend/src/
    â”œâ”€â”€ lib/services/notificationService.ts
    â”œâ”€â”€ lib/types/index.ts
    â””â”€â”€ lib/components/organisms/NotificationBell.svelte
```

### Ø³Ø±ÙˆÛŒØ³ Ø¬Ø¯ÛŒØ¯ (Ø¬Ø¯Ø§Ú¯Ø§Ù†Ù‡):

```
reminder-service/
â”œâ”€â”€ main.py
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ .env.example
â””â”€â”€ Dockerfile
```

---

## ğŸ”§ Ø¯Ø³ØªÙˆØ±Ø§Ù„Ø¹Ù…Ù„ Ø§Ø¬Ø±Ø§

### Û±. Ø§Ø¬Ø±Ø§ÛŒ Ø¯ÛŒØªØ§Ø¨ÛŒØ³:

```bash
# Ø¯Ø± Supabase SQL Editor Ø§Ø¬Ø±Ø§ Ú©Ù†ÛŒØ¯
# ÛŒØ§ Ø§Ø² CLI Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯
supabase migration up
```

### Û². Ø§Ø¬Ø±Ø§ÛŒ Ø³Ø±ÙˆÛŒØ³ Python (Ù„ÙˆÚ©Ø§Ù„):

```bash
cd reminder-service

# Ù†ØµØ¨ dependencies
pip install -r requirements.txt

# Ú©Ù¾ÛŒ Ú©Ø±Ø¯Ù† ÙØ§ÛŒÙ„ .env.example Ø¨Ù‡ .env Ùˆ Ù¾Ø± Ú©Ø±Ø¯Ù† Ù…Ù‚Ø§Ø¯ÛŒØ±
cp .env.example .env
# Ø³Ù¾Ø³ .env Ø±Ø§ ÙˆÛŒØ±Ø§ÛŒØ´ Ú©Ù†ÛŒØ¯ Ùˆ SUPABASE_URL Ùˆ SUPABASE_SERVICE_ROLE_KEY Ø±Ø§ ØªÙ†Ø¸ÛŒÙ… Ú©Ù†ÛŒØ¯

# Ø§Ø¬Ø±Ø§ÛŒ Ø³Ø±ÙˆÛŒØ³
python main.py
```

**Ù†Ú©ØªÙ‡ Ù…Ù‡Ù…:**

- Ø¨Ø±Ø§ÛŒ ØªØ³ØªØŒ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ `CRON_TIME` Ø±Ø§ Ø¨Ù‡ Ø²Ù…Ø§Ù† ÙØ¹Ù„ÛŒ ØªÙ†Ø¸ÛŒÙ… Ú©Ù†ÛŒØ¯ (Ù…Ø«Ù„Ø§Ù‹ 2 Ø¯Ù‚ÛŒÙ‚Ù‡ Ø¯ÛŒÚ¯Ø±)
- Ø¨Ø±Ø§ÛŒ productionØŒ Ø§Ø² cron ÙˆØ§Ù‚Ø¹ÛŒ Ø³ÛŒØ³ØªÙ…â€ŒØ¹Ø§Ù…Ù„ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯ ÛŒØ§ Ø§Ø² scheduler Ø³Ø±ÙˆÛŒØ³ cloud Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯

### Û³. Ø§Ø³ØªÙ‚Ø±Ø§Ø± Ø¯Ø± Ú†Ø§Ø¨Ú©Ø§Ù†:

- ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ Ø±Ø§ Ø¢Ù¾Ù„ÙˆØ¯ Ú©Ù†ÛŒØ¯
- Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ù…Ø­ÛŒØ·ÛŒ Ø±Ø§ ØªÙ†Ø¸ÛŒÙ… Ú©Ù†ÛŒØ¯
- Cron Job Ø±Ø§ ÙØ¹Ø§Ù„ Ú©Ù†ÛŒØ¯

---

## ğŸ“ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ùˆ Ø¹ÛŒØ¨â€ŒÛŒØ§Ø¨ÛŒ

Ø¯Ø± ØµÙˆØ±Øª Ø¨Ø±ÙˆØ² Ù…Ø´Ú©Ù„:

1. **Ù„Ø§Ú¯â€ŒÙ‡Ø§ÛŒ Python:** Ø¨Ø±Ø±Ø³ÛŒ Ù„Ø§Ú¯â€ŒÙ‡Ø§ Ø¨Ø±Ø§ÛŒ Ø®Ø·Ø§Ù‡Ø§ÛŒ Ø§ØªØµØ§Ù„ Ø¨Ù‡ Supabase ÛŒØ§ Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø¯Ø§Ø¯Ù‡
2. **Ø¯ÛŒØªØ§Ø¨ÛŒØ³:** Ø¨Ø±Ø±Ø³ÛŒ Ø¬Ø¯ÙˆÙ„ `notifications` Ø¯Ø± Supabase Dashboard
3. **ÙØ±Ø§Ù†Øªâ€ŒØ§Ù†Ø¯:** Ú©Ù†Ø³ÙˆÙ„ Ù…Ø±ÙˆØ±Ú¯Ø± Ø¨Ø±Ø§ÛŒ Ø®Ø·Ø§Ù‡Ø§ÛŒ Realtime ÛŒØ§ Supabase
4. **RLS Policies:** Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø§Ø² Ø§ÛŒÙ†Ú©Ù‡ Ù¾Ø§Ù„ÛŒØ³ÛŒâ€ŒÙ‡Ø§ÛŒ RLS Ø¨Ù‡ Ø¯Ø±Ø³ØªÛŒ ØªÙ†Ø¸ÛŒÙ… Ø´Ø¯Ù‡â€ŒØ§Ù†Ø¯
5. **Service Role Key:** Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø§Ø² Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Service Role Key (Ù†Ù‡ anon key) Ø¯Ø± Python
6. **Realtime:** Ø¨Ø±Ø±Ø³ÛŒ ÙØ¹Ø§Ù„ Ø¨ÙˆØ¯Ù† Realtime Ø¨Ø±Ø§ÛŒ Ø¬Ø¯ÙˆÙ„ `notifications` Ø¯Ø± Supabase Dashboard

### Ù…Ø´Ú©Ù„Ø§Øª Ø±Ø§ÛŒØ¬:

**Ù…Ø´Ú©Ù„:** Python Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø¨Ù‡ Supabase Ù…ØªØµÙ„ Ø´ÙˆØ¯

- **Ø±Ø§Ù‡â€ŒØ­Ù„:** Ø¨Ø±Ø±Ø³ÛŒ `SUPABASE_URL` Ùˆ `SUPABASE_SERVICE_ROLE_KEY` Ø¯Ø± `.env`

**Ù…Ø´Ú©Ù„:** Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù† Ø¯Ø± ÙØ±Ø§Ù†Øªâ€ŒØ§Ù†Ø¯ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯

- **Ø±Ø§Ù‡â€ŒØ­Ù„:** Ø¨Ø±Ø±Ø³ÛŒ Ø§ØªØµØ§Ù„ Realtime Ø¯Ø± Supabase Dashboard â†’ Replication

**Ù…Ø´Ú©Ù„:** RLS Policy Ø®Ø·Ø§ Ù…ÛŒâ€ŒØ¯Ù‡Ø¯

- **Ø±Ø§Ù‡â€ŒØ­Ù„:** Ø¨Ø±Ø§ÛŒ Python Ø¨Ø§ÛŒØ¯ Ø§Ø² Service Role Key Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø´ÙˆØ¯ Ú©Ù‡ RLS Ø±Ø§ Ø¯ÙˆØ± Ù…ÛŒâ€ŒØ²Ù†Ø¯

---

## âš ï¸ Ù†Ú©Ø§Øª Ù…Ù‡Ù…

1. **Service Role Key:** Ù‡Ø±Ú¯Ø² Service Role Key Ø±Ø§ Ø¯Ø± frontend Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù†Ú©Ù†ÛŒØ¯! ÙÙ‚Ø· Ø¯Ø± backend/Python
2. **Cron Job:** Ø¯Ø± production Ø§Ø² cron ÙˆØ§Ù‚Ø¹ÛŒ Ø³ÛŒØ³ØªÙ…â€ŒØ¹Ø§Ù…Ù„ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯ØŒ Ù†Ù‡ `schedule` library
3. **Migration:** Ù‚Ø¨Ù„ Ø§Ø² Ø§Ø¬Ø±Ø§ÛŒ migration Ø¯Ø± productionØŒ ÛŒÚ© backup Ø§Ø² Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ø¨Ú¯ÛŒØ±ÛŒØ¯
4. **Performance:** Indexâ€ŒÙ‡Ø§ÛŒ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ø¨Ù‡Ø¨ÙˆØ¯ Ú©Ø§Ø±Ø§ÛŒÛŒ Ø¯Ø± queryâ€ŒÙ‡Ø§ÛŒ Ø¨Ø²Ø±Ú¯ Ø¶Ø±ÙˆØ±ÛŒ Ù‡Ø³ØªÙ†Ø¯
5. **Error Handling:** Ú©Ø¯ Python Ø¨Ø§ error handling Ú©Ø§Ù…Ù„ Ù†ÙˆØ´ØªÙ‡ Ø´Ø¯Ù‡ ØªØ§ Ø¯Ø± ØµÙˆØ±Øª Ø®Ø·Ø§ crash Ù†Ú©Ù†Ø¯

---

**ØªØ§Ø±ÛŒØ® Ø¢Ø®Ø±ÛŒÙ† Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ:** Û²Û· Ø¯ÛŒ Û±Û´Û°Û´
**ÙˆØ¶Ø¹ÛŒØª:** âœ… Ø¢Ù…Ø§Ø¯Ù‡ Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ
**Ù†Ú©ØªÙ‡ Ú©Ù„ÛŒØ¯ÛŒ:** Ù‡Ø± Ø®ÙˆØ¯Ø±Ùˆ `interval_days` Ù…Ø®ØµÙˆØµ Ø®ÙˆØ¯ Ø±Ø§ Ø¯Ø§Ø±Ø¯ Ú©Ù‡ Ø§Ø² Ø¬Ø¯ÙˆÙ„ `reminder_settings` Ø®ÙˆØ§Ù†Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯
