# دستور ساخت فنی (Project Spec) برای MVP KhodroBan (خودروبان)

> این سند راهنمای فنی اجرای MVP است و باید با این اسناد هم‌راستا بماند:
> - `docs/product/overview.md`
> - `docs/strategy/project-plan.md`
> - `docs/research/competitors/analyses/combined-competitor-analysis.md`

---

## 1) نام پروژه

- **نام محصول در ریپو**: KhodroBan
- **نام فارسی برند**: «خودروبان»

> نکته: نام پروژه به **KhodroBan (خودروبان)** تغییر یافته است.

---

## 2) توضیح محصول (MVP)

KhodroBan (خودروبان) یک وب‌اپلیکیشن واکنش‌گرا (Mobile-First) برای مالکان خودرو در ایران است که:

- اطلاعات خودرو(ها) را ثبت می‌کند
- سوابق سرویس/تعویض روغن را نگه می‌دارد
- یادآوری **دو معیاری** (زمان/کیلومتر) تولید می‌کند
- هزینه‌های خودرو (از جمله **هزینه‌های روزانه مثل سوخت**) را ثبت و گزارش ساده ارائه می‌دهد
- داده‌ها را **ابری** همگام‌سازی می‌کند تا از دست نرود

**مدل درآمدی**: فریمیوم (رایگان پایه + اشتراک Pro برای ارزش‌های ملموس مثل سینک/خروجی/خودروهای بیشتر و یادآوری مطمئن‌تر)

---

## 3) اهداف MVP و معیار «قابل فروش بودن»

### 3.1 ارزش‌هایی که کاربر بابتشان پول می‌دهد

- **امنیت و دوام داده**: بکاپ/سینک ابری (از دست نرفتن سوابق)
- **چند خودرو** (خانواده/مالک چند خودرو)
- **خروجی گرفتن** از داده‌ها (CSV/PDF)
- **یادآوری قابل اتکا** (حداقل داخل اپ + ایمیل؛ در صورت نیاز/امکان: SMS در پلن Pro)

### 3.2 غیرهدف‌های MVP (عمداً حذف/موکول)

- PWA و Offline-first
- Push Notifications مرورگرها (به‌خصوص محدودیت‌های iOS)
- اتصال به مراکز/رزرو آنلاین/مارکت‌پلیس
- چت‌بات/دستیار AI
- گزارش‌های سنگین و داشبوردهای پیچیده

---

## 4) Core Loop (چرخه اصلی MVP)

### کاربر چه می‌دهد؟

- افزودن خودرو و **کیلومتر فعلی**
- ثبت سرویس (تاریخ، کیلومتر، هزینه، توضیح)
- ثبت هزینه‌های روزانه (مثل سوخت/کارواش/پارکینگ/تعمیر جزئی)
- تنظیمات یادآوری (فاصله کیلومتر/زمان، و کانال ایمیل)

### سیستم چه می‌کند؟

- داده‌ها را در Backend ذخیره و همگام‌سازی می‌کند
- برای هر خودرو «موعد سرویس بعدی» را با منطق دو معیاری محاسبه می‌کند
- وضعیت‌ها را تولید می‌کند: «OK / نزدیک موعد / گذشته از موعد»
- یادآوری‌ها را از طریق:
  - **داخل اپ** (Inbox/Badge)
  - **ایمیل** (MVP)
  - **SMS** (اختیاری: Pro یا فاز بعد)

### خروجی برای کاربر چیست؟

- داشبورد ساده: سرویس بعدی هر خودرو + هشدارهای فعال
- گزارش هزینه‌ها: جمع هزینه‌ها + لیست فیلترشده
- خروجی داده‌ها: CSV (و PDF برای Pro)

---

## 5) Site Map (صفحات MVP)

ناوبری Mobile-First با نوار پایین:
- Dashboard
- Vehicles
- Add (Service/Expense)
- Reports
- Settings

### 5.1 Login/Register
- ایمیل/پسورد + فراموشی پسورد
- بدون حساب: فقط دمو محدود (اختیاری)

### 5.2 Dashboard
- لیست خودروها با: کیلومتر فعلی، سرویس بعدی، وضعیت (رنگی)
- هشدارهای فعال (نزدیک/گذشته)
- میانبر: «ثبت سرویس» و «ثبت هزینه»

### 5.3 Vehicles
- لیست خودروها + افزودن/ویرایش/حذف
- صفحه جزئیات خودرو:
  - سوابق سرویس
  - لیست هزینه‌های روزانه
  - به‌روزرسانی کیلومتر

### 5.4 Add (Service / Expense)
- یک صفحه واحد با Tab/Toggle:
  - **ثبت سرویس/تعویض روغن**
  - **ثبت هزینه روزانه**

### 5.5 Reports
- فیلتر: خودرو، بازه تاریخ، نوع (سرویس/هزینه روزانه)
- جمع هزینه‌ها (ماهانه/سالانه)
- خروجی CSV (و PDF برای Pro)

### 5.6 Settings
- پروفایل + تغییر پسورد
- تنظیمات یادآوری
- مدیریت اشتراک Pro
- Export کامل داده‌ها

---

## 6) Forms (فرم‌ها)

### 6.1 Registration/Login
- ایمیل (اجباری)
- پسورد (اجباری)

### 6.2 Add/Edit Vehicle
- مدل (اجباری)
- سال ساخت (اجباری)
- پلاک (اجباری)
- کیلومتر فعلی (اجباری)
- توضیح (اختیاری)

### 6.3 Add/Edit Service
- خودرو (اجباری)
- تاریخ (شمسی) (اجباری)
- کیلومتر زمان سرویس (اجباری)
- هزینه (تومان) (اجباری)
- نوع سرویس (پیش‌فرض: تعویض روغن؛ سایر گزینه‌ها اختیاری)
- توضیح (اختیاری)

### 6.4 Add/Edit Daily Expense
- خودرو (اجباری)
- تاریخ (شمسی) (اجباری)
- مبلغ (تومان) (اجباری)
- دسته‌بندی (اجباری): سوخت/کارواش/پارکینگ/عوارض/تعمیر جزئی/سایر
- کیلومتر (اختیاری)
- توضیح (اختیاری)

### 6.5 Reminder Settings
- فاصله کیلومتر پیش‌فرض (مثلاً ۵۰۰۰)
- فاصله زمانی پیش‌فرض (مثلاً ۳ ماه)
- روزهای هشدار قبل از موعد (مثلاً ۷ روز)
- کانال‌ها: داخل اپ + ایمیل (SMS: Pro/اختیاری)

---

## 7) منطق یادآوری (Reminder Engine)

### 7.1 داده‌های مبنا
- آخرین سرویس ثبت‌شده برای هر خودرو (تاریخ و کیلومتر)
- تنظیمات کاربر/خودرو: interval_km و interval_time

### 7.2 محاسبه موعد
- `due_at_km = last_service_km + interval_km`
- `due_at_date = last_service_date + interval_time`

### 7.3 وضعیت‌ها
- **گذشته از موعد**: اگر (km فعلی >= due_at_km) یا (امروز >= due_at_date)
- **نزدیک موعد**: اگر (due_at_date - امروز <= threshold_days) یا (due_at_km - km فعلی <= threshold_km)
- **OK**: سایر حالات

> نکته MVP: چون Push نداریم، برای کیلومترمحور بودن، یک ایمیل «یادآوری به‌روزرسانی کیلومتر» (مثلاً ماهی یک‌بار) می‌تواند ارزش ایجاد کند.

---

## 8) معماری و تکنولوژی

### 8.1 Frontend
- Vite + Svelte
- UI RTL فارسی + تقویم شمسی

### 8.2 Backend
- Django + Django REST Framework
- PostgreSQL

### 8.3 Auth
- نسخه MVP: ایمیل/پسورد
- (اختیاری) استفاده از JWT یا Session (تصمیم نهایی در شروع پیاده‌سازی)

### 8.4 ارسال ایمیل
- MVP: سرویس SMTP/Provider (قابل تغییر)
- صف/زمان‌بندی: Celery + Celery Beat (یا جایگزین سبک‌تر اگر لازم شد)

---

## 9) پلن‌ها و محدودیت‌ها (Freemium)

### Free
- تعداد خودرو: ۱ (یا ۲)
- خروجی: CSV محدود
- یادآوری: داخل اپ + ایمیل پایه

### Pro
- تعداد خودرو: بیشتر/نامحدود
- خروجی: CSV کامل + PDF
- یادآوری: ایمیل چندمرحله‌ای + (اختیاری) SMS

---

## 10) نیازمندی‌های غیرعملکردی

- عملکرد: لود اولیه سریع، UX ساده و کم‌کلیک
- امنیت: رمزنگاری پسورد، نرخ‌محدودسازی لاگین، حداقل‌سازی داده‌ها
- بکاپ: بکاپ دیتابیس (روزانه)
- رصد: لاگ خطا و متریک‌های پایه

