# ุณุฑูุณ ุงุฏุขูุฑ ุณุฑูุณ ุฏูุฑูโุง ุฎูุฏุฑููุง

## ๐ ุงุทูุงุนุงุช ฺฉู

**ูุฏู:** ุจุฑุฑุณ ุฑูุฒุงูู ุฎูุฏุฑููุง ู ุงุฌุงุฏ ููุชูฺฉุดู ุจุฑุง ุงุฏุขูุฑ ุณุฑูุณ ุฏูุฑูโุง  
**ููุน:** Python Cron Job  
**ุชุงุฑุฎ ุงุฌุงุฏ:** ฒท ุฏ ฑดฐด

---

## ๐ฏ ูฺฺฏโูุง

- โ ุจุฑุฑุณ ุฑูุฒุงูู ุฎูุฏุฑููุง ูุงุฒููุฏ ุณุฑูุณ
- โ ูพุดุชุจุงู ุงุฒ `interval_days` ูุชูุงูุช ุจุฑุง ูุฑ ุฎูุฏุฑู
- โ ุงุฌุงุฏ ููุชูฺฉุดู ุฏุฑ Supabase
- โ ุฌููฺฏุฑ ุงุฒ ุชฺฉุฑุงุฑ ููุชูฺฉุดู
- โ ูุงฺฏโฺฏุฑ ฺฉุงูู
- โ Error handling ฺฉุงูู

---

## ๐ฆ ูุตุจ ู ุฑุงูโุงูุฏุงุฒ

### ฑ. ูุตุจ dependencies

```bash
cd reminder-service
pip install -r requirements.txt
```

### ฒ. ูพฺฉุฑุจูุฏ ูุชุบุฑูุง ูุญุท

```bash
cp .env.example .env
```

ุณูพุณ ูุงู `.env` ุฑุง ูุฑุงุด ฺฉูุฏ:

```env
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key-here
CRON_TIME=08:00
```

**ูฺฉุชู ููู:** ุจุฑุง `SUPABASE_SERVICE_ROLE_KEY` ุงุฒ ฺฉูุฏ Service Role ุงุณุชูุงุฏู ฺฉูุฏ (ูู anon key).

### ณ. ุงุฌุฑุง ุชุณุช ุงููู

```bash
python main.py
```

ุจุฑุง ุชุณุช ุณุฑุนุ ูโุชูุงูุฏ `CRON_TIME` ุฑุง ุจู ุฒูุงู ูุนู ุชูุธู ฺฉูุฏ (ูุซูุงู 2 ุฏููู ุฏฺฏุฑ).

---

## โ๏ธ ูุญูู ฺฉุงุฑ

### ููุทู ุงุฏุขูุฑ:

1. **ุฎูุงูุฏู ุฎูุฏุฑููุง:** ุงุฒ ุชุงุจุน `get_vehicles_for_reminder()` ุฏุฑ Supabase
2. **ุฎูุงูุฏู ุขุฎุฑู ุณุฑูุณ:** ุงุฒ ุฌุฏูู `services` ุจุฑุง ูุฑ ุฎูุฏุฑู
3. **ูุญุงุณุจู:** 
   - `days_since_last` = ุงูุฑูุฒ - ุขุฎุฑู ุณุฑูุณ
   - `days_until_due` = `interval_days` - `days_since_last`
4. **ุจุฑุฑุณ ุจุงุฒู ูุดุฏุงุฑ:** ุงฺฏุฑ `0 < days_until_due <= warning_days`
5. **ุงุฌุงุฏ ููุชูฺฉุดู:** ุฏุฑ ุฌุฏูู `notifications`

### ุฌููฺฏุฑ ุงุฒ ุชฺฉุฑุงุฑ:

- ุจุฑุฑุณ ูโฺฉูุฏ ฺฉู ุขุง ููุชูฺฉุดู ุจุง `days_until_due` ูุดุงุจู ูุจูุงู ุงุฑุณุงู ุดุฏู
- ุงฺฏุฑ ุจููุ ุงุฒ ุงุฑุณุงู ูุฌุฏุฏ ุฌููฺฏุฑ ูโฺฉูุฏ

---

## ๐ณ ุงุณุชูุฑุงุฑ ุจุง Docker

### ุณุงุฎุช ุชุตูุฑ:

```bash
docker build -t reminder-service:latest .
```

### ุงุฌุฑุง:

```bash
docker run -d \
  --name reminder-service \
  --env-file .env \
  reminder-service:latest
```

---

## ๐ ุงุณุชูุฑุงุฑ ุฏุฑ ฺุงุจฺฉุงู

### ฑ. ุงุฌุงุฏ ุณุฑูุณ:

1. ูุงุฑุฏ ูพูู ฺุงุจฺฉุงู ุดูุฏ
2. ุจุฎุด **ูุงุณุช ุงุจุฑ (PaaS)**
3. **ุงุฌุงุฏ ุณุฑูุณ ุฌุฏุฏ** โ **Python**
4. ุชูุธูุงุช:
   - ูุงู: `reminder-service`
   - ููุจุน: ุขูพููุฏ ูุงูโูุง ูพูุดู `reminder-service`
   - ูุชุบุฑูุง ูุญุท: ุงุฒ `.env`

### ฒ. ุชูุธู Cron Job:

ุฏุฑ ุจุฎุด **Cron Jobs** ูพูู ฺุงุจฺฉุงู:

- **ุฒูุงู:** `0 8 * * *` (ูุฑ ุฑูุฒ ุณุงุนุช ธ ุตุจุญ)
- **ุฏุณุชูุฑ:** `python main.py`
- **ูุณุฑ:** `/app` (ูพูุดู ุณุฑูุณ)

---

## ๐ ูุงฺฏโูุง

ูุงฺฏโูุง ุจู ุตูุฑุช ุงุณุชุงูุฏุงุฑุฏ ุฎุฑูุฌ ุฏุงุฏู ูโุดููุฏ:

```
2025-01-16 08:00:00 - INFO - ุดุฑูุน ุจุฑุฑุณ ุงุฏุขูุฑูุง ุฒูุงู...
2025-01-16 08:00:01 - INFO - ุชุนุฏุงุฏ 3 ุฎูุฏุฑู ุจุฑุง ุจุฑุฑุณ ูพุฏุง ุดุฏ
2025-01-16 08:00:02 - INFO - โ ููุชูฺฉุดู ุงุฌุงุฏ ุดุฏ: ูพุฑุงุฏ - 7 ุฑูุฒ ูุงูุฏู
```

ุจุฑุง ูุดุงูุฏู ูุงฺฏโูุง ุฏุฑ ฺุงุจฺฉุงูุ ุจู ุจุฎุด **Logs** ุจุฑูุฏ.

---

## ๐ง ุนุจโุงุจ

### ูุดฺฉู: ุฎุทุง ุฏุฑ ุงุชุตุงู ุจู Supabase
**ุฑุงูโุญู:** ุจุฑุฑุณ `SUPABASE_URL` ู `SUPABASE_SERVICE_ROLE_KEY` ุฏุฑ `.env`

### ูุดฺฉู: ูฺ ุฎูุฏุฑู ูพุฏุง ููโุดูุฏ
**ุฑุงูโุญู:** 
- ุจุฑุฑุณ ูุนุงู ุจูุฏู `is_enabled` ุฏุฑ `reminder_settings`
- ุจุฑุฑุณ `reminder_mode` (ุจุงุฏ 'time' ุง 'both' ุจุงุดุฏ)

### ูุดฺฉู: ููุชูฺฉุดู ุชฺฉุฑุงุฑ ุงุฑุณุงู ูโุดูุฏ
**ุฑุงูโุญู:** ุจุฑุฑุณ ููุทู ุฌููฺฏุฑ ุงุฒ ุชฺฉุฑุงุฑ ุฏุฑ ฺฉุฏ Python

---

## โ๏ธ ูฺฉุงุช ุงููุช

1. **ูุฑฺฏุฒ** `SUPABASE_SERVICE_ROLE_KEY` ุฑุง ุฏุฑ ูุฑุงูุชโุงูุฏ ุงุณุชูุงุฏู ูฺฉูุฏ
2. **ููุท** ุฏุฑ backend/Python ุงุณุชูุงุฏู ุดูุฏ
3. ุจุฑุง production ุงุฒ ูุชุบุฑูุง ูุญุท ุงูู ุงุณุชูุงุฏู ฺฉูุฏ

---

## ๐ ูพุดุชุจุงู

ุฏุฑ ุตูุฑุช ุจุฑูุฒ ูุดฺฉู:
1. ูุงฺฏโูุง Python ุฑุง ุจุฑุฑุณ ฺฉูุฏ
2. ุฌุฏูู `notifications` ุฏุฑ Supabase Dashboard ุฑุง ุจุจูุฏ
3. ุจุฑุฑุณ ฺฉูุฏ ฺฉู `get_vehicles_for_reminder()` ุฏุงุฏู ุจุฑูโฺฏุฑุฏุงูุฏ

---

**ูุถุนุช:** โ ุขูุงุฏู ุงุณุชูุฑุงุฑ  
**ุขุฎุฑู ุจุฑูุฒุฑุณุงู:** ฒท ุฏ ฑดฐด
